<div class="p-4">
  <h2 class="text-2xl font-semibold mb-4">Products</h2>

  @if (loading) {
    <p class="text-gray-600">Loading products...</p>
  }

  @if (!loading && errorMessage) {
    <p class="text-red-600">{{ errorMessage }}</p>
  }

  @if (!loading && !errorMessage && products.length === 0) {
    <p class="text-gray-600">No products found.</p>
  }

  @if (!loading && products.length > 0) {
    <div class="overflow-x-auto border rounded-lg bg-white shadow">
      <table class="w-full">
        <thead>
          <tr class="bg-gray-100 border-b">
            <th class="p-2 border-r">Image</th>
            <th class="p-2 border-r">Title</th>
            <th class="p-2 border-r">Price</th>
            <th class="p-2 border-r">Category</th>
            <th class="p-2">Actions</th>
          </tr>
        </thead>

        <tbody>
          @for (p of products; track p._id) {
            <tr class="border-b hover:bg-gray-50 transition">
              <td class="border-r p-2">
                <img
                  [src]="p.images?.[0]"
                  alt="{{ p.title }}"
                  class="w-16 h-16 object-cover rounded"
                />
              </td>

              <td class="border-r p-2 font-medium">{{ p.title }}</td>
              <td class="border-r p-2">₹{{ p.price }}</td>
              <td class="border-r p-2">
                {{ p.category?.name || '—' }}
              </td>

              <td class="p-2 flex gap-2">
                <button
                  class="px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700"
                  (click)="editProduct(p._id)"
                >
                  Edit
                </button>

                <button
                  class="px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700"
                  (click)="deleteProduct(p._id)"
                >
                  Delete
                </button>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- PAGINATION -->
    <div class="flex items-center justify-between mt-6 px-1">

      <!-- Prev -->
      <button
        class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50"
        (click)="prevPage()"
        [disabled]="page === 1"
      >
        Prev
      </button>

      <!-- Page Numbers -->
      <div class="flex gap-2">
        @for (num of pages(); track num) {
          <button
            class="px-3 py-1 rounded transition"
            [class.bg-blue-600]="num === page"
            [class.text-white]="num === page"
            [class.bg-gray-200]="num !== page"
            (click)="goToPage(num)"
          >
            {{ num }}
          </button>
        }
      </div>

      <!-- Next -->
      <button
        class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50"
        (click)="nextPage()"
        [disabled]="page === totalPages"
      >
        Next
      </button>

    </div>

    <!-- Showing x of y -->
    <div class="text-sm text-gray-600 mt-2 text-center">
      Showing
      <strong>{{ Math.min(page * limit, total) }}</strong>
      of
      <strong>{{ total }}</strong>
      products
    </div>
  }
</div>
