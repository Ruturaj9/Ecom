<div id="top" class="scroll-anchor"></div>

<div class="max-w-7xl mx-auto px-4 py-10 grid md:grid-cols-4 gap-8">

  <!-- Sidebar Filters -->
  <div class="md:col-span-1 bg-white p-5 rounded-xl shadow">
    <h2 class="text-lg font-bold mb-4">Filters</h2>

    <!-- Search -->
    <label class="block text-sm font-medium mb-1">Search</label>
    <input
      type="text"
      [(ngModel)]="searchText"
      (input)="onFilterChanged()"
      class="w-full px-3 py-2 border rounded-lg mb-4"
      placeholder="Search by name..."
    />

    <!-- Category -->
    <label class="block text-sm font-medium mb-1">Category</label>
    <select
      [(ngModel)]="selectedCategory"
      (change)="onFilterChanged()"
      class="w-full px-3 py-2 border rounded-lg mb-4"
    >
      @for (c of categories(); track c) {
        <option [value]="c">{{ c }}</option>
      }
    </select>

    <!-- Sort -->
    <label class="block text-sm font-medium mb-1">Sort By</label>
    <select
      [(ngModel)]="sortBy"
      (change)="onFilterChanged()"
      class="w-full px-3 py-2 border rounded-lg"
    >
      <option value="none">None</option>
      <option value="low-high">Price: Low → High</option>
      <option value="high-low">Price: High → Low</option>
    </select>
  </div>

  <!-- Product Listing -->
  <div class="md:col-span-3">

    <h2 class="text-2xl font-bold mb-4">Products</h2>

    <!-- Loading -->
    @if (loading()) {
      <p class="text-gray-600">Loading products...</p>
    }

    <!-- Error -->
    @if (!loading() && errorMessage()) {
      <p class="text-red-600">{{ errorMessage() }}</p>
    }

    <!-- Product Grid -->
    @if (!loading() && !errorMessage()) {
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (p of products(); track p._id) {
          <app-product-card [product]="p"></app-product-card>
        }
      </div>

      <!-- Pagination -->
      @if (totalPages() > 1) {
        <div class="flex justify-between mt-6 items-center">

          <!-- Prev -->
          <button
            class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50"
            (click)="prevPage()"
            [disabled]="page() === 1"
          >
            Prev
          </button>

          <!-- Page Numbers -->
          <div class="flex gap-2">
            @for (num of pages(); track num) {
              <button
                class="px-3 py-1 rounded font-medium"
                [class.bg-emerald-600]="num === page()"
                [class.text-white]="num === page()"
                [class.bg-gray-200]="num !== page()"
                (click)="goToPage(num)"
              >
                {{ num }}
              </button>
            }
          </div>

          <!-- Next -->
          <button
            class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300 disabled:opacity-50"
            (click)="nextPage()"
            [disabled]="page() === totalPages()"
          >
            Next
          </button>
        </div>

        <div class="text-center text-sm text-gray-600 mt-2">
          Showing
          <strong>{{ Math.min(page() * limit(), total()) }}</strong>
          of
          <strong>{{ total() }}</strong> products
        </div>
      }
    }

  </div>
</div>
