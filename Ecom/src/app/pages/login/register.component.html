<div class="min-h-screen flex items-center justify-center bg-gray-50 px-4">
  <div
    class="w-full max-w-md bg-white rounded-2xl shadow-xl border p-8"
  >
    <h2
      class="text-3xl font-extrabold text-center text-emerald-700 mb-2"
    >
      Create Account
    </h2>
    <p class="text-center text-gray-600 mb-6">
      Join Himalaya Agro
    </p>

    <!-- SUCCESS MESSAGE -->
    @if (successMessage) {
      <div
        class="bg-green-50 text-green-700 border border-green-200 p-3 rounded-lg text-sm mb-4"
      >
        {{ successMessage }}
      </div>
    }

    <!-- ERROR MESSAGE -->
    @if (errorMessage) {
      <div
        class="bg-red-50 text-red-700 border border-red-200 p-3 rounded-lg text-sm mb-4"
      >
        {{ errorMessage }}
      </div>
    }

    <!-- OTP STEP -->
    @if (otpStep) {
      <div class="space-y-4">
        <p class="text-sm text-gray-700">
          Enter the OTP sent to your mobile.
        </p>

        <input
          [(ngModel)]="otpCode"
          placeholder="123456"
          class="w-full p-3 border rounded-xl focus:ring-2 ring-emerald-500 outline-none text-center text-lg"
        />

        @if (otpError) {
          <p class="text-xs text-red-600">{{ otpError }}</p>
        }

        <div class="flex items-center gap-3">
          <button
            (click)="verifyOtp()"
            class="flex-1 py-2 bg-emerald-600 text-white rounded-xl font-medium hover:bg-emerald-700"
          >
            Verify OTP
          </button>

          <button
            (click)="resendOtp()"
            [disabled]="resendSeconds > 0"
            class="px-3 py-2 border rounded-xl text-sm hover:bg-gray-100 disabled:opacity-60"
          >
            @if (resendSeconds > 0) {
              Resend ({{ resendSeconds }})
            }
            @else {
              Resend
            }
          </button>
        </div>

        <p class="text-sm text-gray-500">
          Didn't receive it? Try again or check network coverage.
        </p>
      </div>
    }

    <!-- MAIN REGISTRATION FORM -->
    @else {
      <form
        [formGroup]="form"
        (ngSubmit)="register()"
        class="space-y-5"
      >
        <!-- FULL NAME -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Full Name</label
          >
          <input
            formControlName="name"
            placeholder="John Doe"
            class="w-full p-3 border rounded-xl focus:ring-2 ring-emerald-500 outline-none"
          />
          @if (f['name'].touched && f['name'].invalid) {
            <p class="text-xs text-red-600 mt-1">
              Name must be at least 3 characters.
            </p>
          }
        </div>

        <!-- EMAIL -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Email</label
          >
          <input
            formControlName="email"
            type="email"
            placeholder="you@example.com"
            class="w-full p-3 border rounded-xl focus:ring-2 ring-emerald-500 outline-none"
          />

          @if (f['email'].touched && f['email'].invalid) {
            <p class="text-xs text-red-600 mt-1">
              @if (f['email'].errors?.['required']) {
                Email is required.
              }
              @if (f['email'].errors?.['email']) {
                Enter a valid email format.
              }
              @if (f['email'].errors?.['pattern']) {
                This email address does not appear valid.
              }
            </p>
          }
        </div>

        <!-- MOBILE -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Mobile (optional)</label
          >
          <input
            formControlName="mobile"
            placeholder="9876543210"
            class="w-full p-3 border rounded-xl focus:ring-2 ring-emerald-500 outline-none"
          />

          @if (f['mobile'].touched && f['mobile'].invalid) {
            <p class="text-xs text-red-600 mt-1">
              Enter a valid mobile number (10–15 digits, no leading 0).
            </p>
          }
        </div>

        <!-- PASSWORD -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Password</label
          >

          <div class="relative">
            <input
              [type]="showPassword ? 'text' : 'password'"
              formControlName="password"
              (input)="checkStrength()"
              placeholder="At least 8 characters"
              class="w-full p-3 border rounded-xl focus:ring-2 ring-emerald-500 outline-none"
            />

            <button
              type="button"
              (click)="toggleShowPassword()"
              class="absolute right-2 top-1/2 -translate-y-1/2 px-2 py-1 text-sm rounded-md"
            >
              @if (showPassword) { Hide } @else { Show }
            </button>
          </div>

          <!-- STRENGTH METER -->
          @if (form.value.password?.length > 0) {
            <div class="mt-2">
              <div
                class="w-full h-2 bg-gray-200 rounded-full overflow-hidden"
              >
                <div
                  class="h-full transition-all duration-300"
                  [ngStyle]="{
                    width: strengthPercent + '%',
                    background: strengthColor
                  }"
                ></div>
              </div>

              <p
                class="text-xs mt-1 font-medium"
                [style.color]="strengthColor"
              >
                Strength: {{ strengthLabel }}
              </p>
            </div>
          }

          @if (f['password'].touched && f['password'].invalid) {
            <p class="text-xs text-red-600 mt-1">
              Password must include uppercase, lowercase, number, symbol
              and be at least 8 characters.
            </p>
          }
        </div>

        <!-- CONFIRM PASSWORD -->
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1"
            >Confirm Password</label
          >

          <div class="relative">
            <input
              [type]="showConfirm ? 'text' : 'password'"
              formControlName="confirmPassword"
              placeholder="Repeat password"
              class="w-full p-3 border rounded-xl focus:ring-2 ring-emerald-500 outline-none"
            />

            <button
              type="button"
              (click)="toggleShowConfirm()"
              class="absolute right-2 top-1/2 -translate-y-1/2 px-2 py-1 text-sm rounded-md"
            >
              @if (showConfirm) { Hide } @else { Show }
            </button>
          </div>

          @if (form.hasError('mismatch')) {
            <p class="text-xs text-red-600 mt-1">
              Passwords do not match.
            </p>
          }
        </div>

        <!-- SUBMIT -->
        <button
          type="submit"
          [disabled]="loading"
          class="w-full py-3 bg-emerald-600 text-white rounded-xl font-semibold hover:bg-emerald-700 shadow-md active:scale-95 transition disabled:opacity-50"
        >
          {{ loading ? 'Creating Account…' : 'Create Account' }}
        </button>

        <!-- LOGIN LINK -->
        <div class="text-center text-sm text-gray-700">
          Already have an account?
          <a
            routerLink="/login"
            class="text-emerald-600 font-semibold hover:underline"
            >Login</a
          >
        </div>

        <!-- RESEND VERIFICATION -->
        @if (successMessage && !form.touched) {
          <div class="mt-3 text-center">
            <button
              type="button"
              (click)="resendEmailVerification()"
              class="text-sm text-emerald-600 hover:underline"
            >
              Resend email verification
            </button>
          </div>
        }
      </form>
    }
  </div>
</div>
